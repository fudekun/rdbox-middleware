#!/usr/bin/env python
# coding: utf-8

import argparse
import subprocess

def command_version(args):
    cmd = 'apt-cache policy rdbox | grep "\*\*\*" | sed -E "s@.*\*\*\*\s(\S+)(\s.*|$)@\\1@g"'
    msg = subprocess.check_output(cmd, shell=True)
    msg = msg.rstrip()
    print("RDBOX's Firmware Version: " + msg)

def command_help(args):
    print(parser.parse_args([args.command, '--help']))

parser = argparse.ArgumentParser(description='RDBOX service.')
subparsers = parser.add_subparsers()

parser_version = subparsers.add_parser('version', help='see `version -h`')
parser_version.set_defaults(handler=command_version)

parser_help = subparsers.add_parser('help', help='see `help -h`')
parser_help.add_argument('command', help='command name which help is shown')
parser_help.set_defaults(handler=command_help)

args = parser.parse_args()
if hasattr(args, 'handler'):
    args.handler(args)
else:
    parser.print_help()
